module.exports=[43108,a=>{"use strict";var b=a.i(37936),c=a.i(48734);async function d(a){let b=`
        SELECT c.*, cat.name as category_name 
        FROM campaigns c 
        LEFT JOIN categories cat ON c.category_id = cat.id
    `,d=[];return a&&"all"!==a&&(b+=" WHERE c.status = ?",d.push(a)),b+=" ORDER BY c.created_at DESC",(0,c.query)(b,d)}async function e(a){return(0,c.queryFirst)(`SELECT c.*, cat.name as category_name 
         FROM campaigns c 
         LEFT JOIN categories cat ON c.category_id = cat.id 
         WHERE c.id = ?`,[a])}async function f(a){return(0,c.queryFirst)(`SELECT c.*, cat.name as category_name 
         FROM campaigns c 
         LEFT JOIN categories cat ON c.category_id = cat.id 
         WHERE c.slug = ?`,[a])}async function g(a){let b=`
        SELECT c.*, cat.name as category_name 
        FROM campaigns c 
        LEFT JOIN categories cat ON c.category_id = cat.id 
        WHERE c.status = 'active' 
        ORDER BY c.is_featured DESC, c.created_at DESC
    `;return a&&(b+=` LIMIT ${a}`),(0,c.query)(b)}async function h(){return(0,c.query)(`SELECT c.*, cat.name as category_name 
         FROM campaigns c 
         LEFT JOIN categories cat ON c.category_id = cat.id 
         WHERE c.status = 'active' AND c.is_featured = 1 
         ORDER BY c.created_at DESC 
         LIMIT 3`)}async function i(){let a=await (0,c.queryFirst)("SELECT COALESCE(SUM(amount), 0) as total FROM donations WHERE status = 'verified'"),b=await (0,c.queryFirst)("SELECT COUNT(*) as count FROM campaigns WHERE status = 'active'"),d=await (0,c.queryFirst)("SELECT COUNT(DISTINCT donor_email) as count FROM donations WHERE status = 'verified'"),e=await (0,c.queryFirst)("SELECT COUNT(*) as count FROM news WHERE status = 'published'"),f=await (0,c.queryFirst)("SELECT COUNT(*) as count FROM donations WHERE status = 'pending'"),g=await (0,c.queryFirst)(`SELECT COALESCE(SUM(amount), 0) as total FROM donations 
         WHERE status = 'verified' 
         AND created_at >= datetime('now', 'start of month')`),h=await (0,c.queryFirst)("SELECT COUNT(*) as count FROM contacts WHERE is_read = 0");return{totalDonations:a?.total||0,activeCampaigns:b?.count||0,totalDonors:d?.count||0,publishedNews:e?.count||0,pendingDonations:f?.count||0,thisMonthDonations:g?.total||0,unreadContacts:h?.count||0}}async function j(a,b="admin-001"){let d=(0,c.generateId)(),e=(0,c.slugify)(a.title)+"-"+Date.now().toString(36);try{await (0,c.execute)(`INSERT INTO campaigns (id, title, slug, description, content, image, category_id, target_amount, start_date, end_date, status, is_featured, created_by)
             VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[d,a.title,e,a.description||"",a.content||"",a.image||"",a.category_id||null,a.target_amount,a.start_date,a.end_date||null,a.status||"draft",+!!a.is_featured,b])}catch(a){throw console.error("createCampaign error:",a),Error("Gagal menyimpan campaign: "+(a?.message||"Unknown error"))}return{id:d,slug:e}}async function k(a,b){let d=[],e=[];void 0!==b.title&&(d.push("title = ?"),e.push(b.title)),void 0!==b.description&&(d.push("description = ?"),e.push(b.description)),void 0!==b.content&&(d.push("content = ?"),e.push(b.content)),void 0!==b.image&&(d.push("image = ?"),e.push(b.image)),void 0!==b.category_id&&(d.push("category_id = ?"),e.push(b.category_id)),void 0!==b.target_amount&&(d.push("target_amount = ?"),e.push(b.target_amount)),void 0!==b.start_date&&(d.push("start_date = ?"),e.push(b.start_date)),void 0!==b.end_date&&(d.push("end_date = ?"),e.push(b.end_date)),void 0!==b.status&&(d.push("status = ?"),e.push(b.status)),void 0!==b.is_featured&&(d.push("is_featured = ?"),e.push(+!!b.is_featured)),d.push("updated_at = ?"),e.push((0,c.nowWIB)()),e.push(a),await (0,c.execute)(`UPDATE campaigns SET ${d.join(", ")} WHERE id = ?`,e)}async function l(a){await (0,c.execute)("DELETE FROM donations WHERE campaign_id = ?",[a]),await (0,c.execute)("DELETE FROM campaigns WHERE id = ?",[a])}(0,a.i(13095).ensureServerEntryExports)([d,e,f,g,h,i,j,k,l]),(0,b.registerServerReference)(d,"4079f844e94cba25888646bdac8a3d25614be20471",null),(0,b.registerServerReference)(e,"40ec91c1144117d069a4696094b401c46ab7182d99",null),(0,b.registerServerReference)(f,"409cca04a1be2c0d6e447f33229b04be2b85932597",null),(0,b.registerServerReference)(g,"402411e0b7d51d811d1ffad2a4014784fab564c71b",null),(0,b.registerServerReference)(h,"0089667f8000a27da36e357964a9a1fcbda200fe24",null),(0,b.registerServerReference)(i,"00f4af0cac1c8e890b45b5077be1a50377bb12d488",null),(0,b.registerServerReference)(j,"605728742b7116473d04380ed7dbc3079fbb81239b",null),(0,b.registerServerReference)(k,"60fef4a62cf605861e0a2c1ee53e8b540be428641f",null),(0,b.registerServerReference)(l,"4075336d921e2e86140348d43d2147334053f471da",null),a.s(["createCampaign",()=>j,"deleteCampaign",()=>l,"getActiveCampaigns",()=>g,"getCampaignById",()=>e,"getCampaignBySlug",()=>f,"getCampaignStats",()=>i,"getCampaigns",()=>d,"getFeaturedCampaigns",()=>h,"updateCampaign",()=>k])},24868,(a,b,c)=>{b.exports=a.x("fs/promises",()=>require("fs/promises"))},88948,a=>{"use strict";var b=a.i(37936);async function c(b){let c=b.get("file");if(!c)throw Error("No file provided");let d=await c.arrayBuffer(),e=Buffer.from(d),f=c.name.split(".").pop()||"png",g=`${Date.now()}-${Math.random().toString(36).slice(2,8)}.${f}`;if("u"<typeof process||globalThis.__cf_env__){try{let a=globalThis.__cf_env__;if(a?.STORAGE)return await a.STORAGE.put(`uploads/${g}`,e,{httpMetadata:{contentType:c.type}}),{url:`/uploads/${g}`}}catch(a){console.error("R2 upload error:",a)}let a=e.toString("base64");return{url:`data:${c.type};base64,${a}`}}{let b=a.r(24868),c=a.r(14747),d=c.join(process.cwd(),"public","uploads");return await b.mkdir(d,{recursive:!0}),await b.writeFile(c.join(d,g),e),{url:`/uploads/${g}`}}}(0,a.i(13095).ensureServerEntryExports)([c]),(0,b.registerServerReference)(c,"40df2b0c12396596b4e6cc85e14bd942bf6ea2e544",null),a.s(["uploadImage",()=>c])},16085,a=>{"use strict";var b=a.i(37936),c=a.i(48734);async function d(a,b=20){return(0,c.query)(`SELECT donor_name, amount, message, is_anonymous, created_at
         FROM donations
         WHERE campaign_id = ? AND status = 'verified'
         ORDER BY created_at DESC
         LIMIT ?`,[a,b])}async function e(a){return await (0,c.execute)("UPDATE news SET view_count = view_count + 1 WHERE slug = ?",[a]),(0,c.queryFirst)(`SELECT n.*, cat.name as category_name, u.name as author_name
         FROM news n
         LEFT JOIN categories cat ON n.category_id = cat.id
         LEFT JOIN users u ON n.author_id = u.id
         WHERE n.slug = ?`,[a])}async function f(a,b,d=3){return(0,c.query)(`SELECT n.*, cat.name as category_name
         FROM news n
         LEFT JOIN categories cat ON n.category_id = cat.id
         WHERE n.status = 'published' AND n.id != ? AND n.category_id = ?
         ORDER BY n.published_at DESC LIMIT ?`,[a,b,d])}async function g(a){let b=(0,c.generateId)();return await (0,c.execute)("INSERT INTO contacts (id, name, email, phone, subject, message) VALUES (?, ?, ?, ?, ?, ?)",[b,a.name,a.email,a.phone||"",a.subject,a.message]),{id:b}}(0,a.i(13095).ensureServerEntryExports)([d,e,f,g]),(0,b.registerServerReference)(d,"60e31ddcb0447823b306bdb0e306027d7f8bda93a5",null),(0,b.registerServerReference)(e,"40a419a27ed8bce24fd0f6230cee833da17b97119b",null),(0,b.registerServerReference)(f,"7075ad8dc5ccfce89285818e099c8f6e9f27ca0d5c",null),(0,b.registerServerReference)(g,"407707b46bd1556ebd576f300bb0453c3f620b2f80",null),a.s(["getCampaignDonors",()=>d,"getNewsBySlug",()=>e,"getRelatedNews",()=>f,"submitContactForm",()=>g])},91053,a=>{"use strict";var b=a.i(37936),c=a.i(48734);async function d(a){let b=`
        SELECT d.*, c.title as campaign_title
        FROM donations d
        LEFT JOIN campaigns c ON d.campaign_id = c.id
    `,d=[];return a&&"all"!==a&&(b+=" WHERE d.status = ?",d.push(a)),b+=" ORDER BY d.created_at DESC",(0,c.query)(b,d)}async function e(a){return(0,c.queryFirst)(`SELECT d.*, c.title as campaign_title
         FROM donations d
         LEFT JOIN campaigns c ON d.campaign_id = c.id
         WHERE d.id = ?`,[a])}async function f(a=5){return(0,c.query)(`SELECT d.*, c.title as campaign_title
         FROM donations d
         LEFT JOIN campaigns c ON d.campaign_id = c.id
         ORDER BY d.created_at DESC LIMIT ?`,[a])}async function g(){let a=await (0,c.queryFirst)(`SELECT COUNT(*) as count, COALESCE(SUM(amount), 0) as total 
         FROM donations WHERE status = 'pending'`),b=await (0,c.queryFirst)(`SELECT COALESCE(SUM(amount), 0) as total FROM donations 
         WHERE status = 'verified' AND created_at >= datetime('now', 'start of month')`),d=await (0,c.queryFirst)("SELECT COALESCE(SUM(amount), 0) as total FROM donations WHERE status = 'verified'");return{pendingCount:a?.count||0,pendingTotal:a?.total||0,verifiedThisMonth:b?.total||0,totalAll:d?.total||0}}async function h(a){let b=(0,c.generateId)();return await (0,c.execute)(`INSERT INTO donations (id, campaign_id, donor_name, donor_email, donor_phone, amount, message, is_anonymous, payment_method, created_at)
         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[b,a.campaign_id,a.donor_name,a.donor_email,a.donor_phone||"",a.amount,a.message||"",+!!a.is_anonymous,a.payment_method||"transfer",(0,c.nowWIB)()]),{id:b}}async function i(a,b){await (0,c.execute)("UPDATE donations SET payment_proof = ? WHERE id = ?",[b,a])}async function j(a,b="admin-001"){let d=await e(a);if(!d)throw Error("Donasi tidak ditemukan");await (0,c.execute)("UPDATE donations SET status = 'verified', verified_by = ?, verified_at = ? WHERE id = ?",[b,(0,c.nowWIB)(),a]),await (0,c.execute)(`UPDATE campaigns SET 
            collected_amount = collected_amount + ?,
            donor_count = donor_count + 1,
            updated_at = ?
         WHERE id = ?`,[d.amount,(0,c.nowWIB)(),d.campaign_id])}async function k(a){await (0,c.execute)("UPDATE donations SET status = 'rejected' WHERE id = ?",[a])}async function l(a){await (0,c.execute)("DELETE FROM donations WHERE id = ?",[a])}(0,a.i(13095).ensureServerEntryExports)([d,e,f,g,h,i,j,k,l]),(0,b.registerServerReference)(d,"40ec595c3630979151c709855655d8fa74ea3d923d",null),(0,b.registerServerReference)(e,"402681618cbf8ab5b5357bb2d8e6970950dfc28908",null),(0,b.registerServerReference)(f,"40b3dcce4287f4bdd8f2090c15b06c9f3793c3aeb4",null),(0,b.registerServerReference)(g,"006ed7c8bf2894eedb249ba77df49f66dbfdffcad2",null),(0,b.registerServerReference)(h,"40ff14a49a40edb98621a06aa5c7509d31de112e24",null),(0,b.registerServerReference)(i,"601c893282998d9caca73bca888b743fc0aa9ee8d9",null),(0,b.registerServerReference)(j,"60d0fe0719260417148140217b5fd39de9db7702bb",null),(0,b.registerServerReference)(k,"4092bd3a821b2d4072c55e5a8ad7af70c2843495d5",null),(0,b.registerServerReference)(l,"406d05b6b77ddc79b723bac7c7b7af0f3cd8fb7046",null),a.s(["createDonation",()=>h,"getDonationSummary",()=>g,"getDonations",()=>d,"getRecentDonations",()=>f,"rejectDonation",()=>k,"updatePaymentProof",()=>i,"verifyDonation",()=>j])},60415,a=>{"use strict";var b=a.i(39624),c=a.i(25737),d=a.i(43108),e=a.i(91053),f=a.i(88948),g=a.i(16085);a.s([],68057),a.i(68057),a.s(["00cf2a8738ddd41ad6903161d87efa51e887637153",()=>c.getTheme,"40745ded225c07a0af4ec4245c71c88dec53a174cf",()=>c.setTheme,"409cca04a1be2c0d6e447f33229b04be2b85932597",()=>d.getCampaignBySlug,"40ccd30b3cc6655717bc8b6776451d6ff35c8e08bd",()=>b.default,"40df2b0c12396596b4e6cc85e14bd942bf6ea2e544",()=>f.uploadImage,"40ff14a49a40edb98621a06aa5c7509d31de112e24",()=>e.createDonation,"601c893282998d9caca73bca888b743fc0aa9ee8d9",()=>e.updatePaymentProof,"60e31ddcb0447823b306bdb0e306027d7f8bda93a5",()=>g.getCampaignDonors],60415)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__2c66d9fe._.js.map